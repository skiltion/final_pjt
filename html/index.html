<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë ˆì‹œí”¼ ì¶”ì²œ & ê²Œì‹œíŒ</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="auth-buttons">
        <button class="login-btn" onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
        <button class="register-btn" onclick="location.href='register.html'">íšŒì›ê°€ì…</button>
        <button class="user-info-btn" onclick="location.href='user-info.html'">íšŒì›ì •ë³´</button>
        <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    
    <div class="container">
        <div class="recipe-container">
            <section class="recipe-section">
                <h2>ë ˆì‹œí”¼ ì¶”ì²œ</h2>
                <form id="recipe-form">
                    <input type="text" id="tastePreference" placeholder="ì…ë§›ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    <input type="text" id="dishName" placeholder="ìš”ë¦¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    <button type="submit">ë ˆì‹œí”¼ ìƒì„±</button>
                </form>
            </section>
            <section class="recipe-output">
                <h2 class="centered">ìƒì„±ëœ ë ˆì‹œí”¼</h2>
                <div id="recipe-output"></div>
            </section>
        </div>
        
        <!-- ê²Œì‹œê¸€ ì˜ì—­ -->
        <section class="posts">
            <h2 class="centered">ê²Œì‹œê¸€</h2>
            <form id="post-form">
                <textarea id="postContent" placeholder="ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ì„¸ìš”" required></textarea>
                <button type="submit">ê²Œì‹œê¸€ ì‘ì„±</button>
            </form>
            <div id="post-list"></div>
        </section>
    </div>
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const token = localStorage.getItem("token");

  const loginBtn = document.querySelector(".login-btn");
  const registerBtn = document.querySelector(".register-btn");
  const userInfoBtn = document.querySelector(".user-info-btn");
  const logoutBtn = document.querySelector(".logout-btn");

  if (token) {
    // ë¡œê·¸ì¸ ìƒíƒœ -> ë¡œê·¸ì¸/íšŒì›ê°€ì… ë²„íŠ¼ ìˆ¨ê¸°ê³ , íšŒì›ì •ë³´/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í‘œì‹œ
    loginBtn.style.display = "none";
    registerBtn.style.display = "none";
    userInfoBtn.style.display = "block";
    logoutBtn.style.display = "block";
  } else {
    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ -> ë¡œê·¸ì¸/íšŒì›ê°€ì… ë²„íŠ¼ í‘œì‹œí•˜ê³ , íšŒì›ì •ë³´/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
    loginBtn.style.display = "block";
    registerBtn.style.display = "block";
    userInfoBtn.style.display = "none";
    logoutBtn.style.display = "none";
  }
});

// ğŸ”´ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ê¸°ëŠ¥ ì¶”ê°€
function logout() {
  localStorage.removeItem("token"); // í† í° ì‚­ì œ
  window.location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ UI ì—…ë°ì´íŠ¸
}

document.getElementById("recipe-form").addEventListener("submit", async function(event) {
  event.preventDefault(); // ğŸ”¥ í¼ ìë™ ì œì¶œ ë°©ì§€

  const tastePreference = document.getElementById("tastePreference").value;
  const dishName = document.getElementById("dishName").value;
  const token = localStorage.getItem("token"); // ì €ì¥ëœ JWT í† í° ê°€ì ¸ì˜¤ê¸°

  if (!tastePreference || !dishName) {
    alert("ì…ë§›ê³¼ ìš”ë¦¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  const response = await fetch("http://localhost:3000/generate-recipe", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": token ? `Bearer ${token}` : "", // í† í°ì´ ìˆì„ ê²½ìš°ë§Œ ì¶”ê°€
    },
    body: JSON.stringify({ tastePreference, dishName }),
  });

  const data = await response.json();
  const outputElement = document.getElementById("recipe-output"); // âœ… ì—¬ê¸° ìˆ˜ì •

  if (response.status === 401) {
    outputElement.innerText = "ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”.";
  } else {
    outputElement.innerText = data.recipe || "ë ˆì‹œí”¼ ìƒì„± ì‹¤íŒ¨";
  }
});
    </script>
</body>
</html>